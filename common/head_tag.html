<!--<script type="module">
  if (
    window.location.href !== "/login" &&
    window.location.href !== "/session/sso"
  ) {
    let discourseAuthenticated;
    try {
      console.log("checking current session");
      const currentSession = await fetch(
        "https://discourse-earthcode.eox.at/session/current.json"
      );
      if (currentSession.ok) {
        console.log("User is authenticated in Discourse");
        discourseAuthenticated = true;
      } else {
        console.log("User is not authenticated in Discourse");
        // window.location.href = "/login";
      }
    } catch (error) {
      console.log("User is not authenticated in Discourse");
    }

    let earthcodeAuthenticated;
    if (!discourseAuthenticated) {
      const module = await import(
        "https://cdn.jsdelivr.net/npm/keycloak-js@26.0.5/lib/keycloak.js"
      );
      const Keycloak = module.default;
      const keycloak = new Keycloak({
        url: "https://hub.earthcode.eox.at/auth",
        realm: "nebari",
        clientId: "discourse",
      });
      try {
        const authenticated = await keycloak.init({
          onLoad: "check-sso",
          checkLoginIframe: false,
        });
        if (authenticated) {
          console.log("User is authenticated in EarthCODE");
          earthcodeAuthenticated = true;
        } else {
          console.log("User is not authenticated in EarthCODE");
        }
      } catch (error) {
        console.error("Failed to initialize adapter:", error);
      }
    }

    if (earthcodeAuthenticated && !discourseAuthenticated) {
      console.log("redirect to login");
      window.location.href = "/login";
    }
  }
</script>-->
